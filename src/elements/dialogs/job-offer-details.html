<link rel="import" href="../../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../../bower_components/app-layout/app-scroll-effects/effects/waterfall.html">
<link rel="import" href="../../../bower_components/app-layout/app-toolbar/app-toolbar.html">

<link rel="import" href="../../../bower_components/plastic-image/plastic-image.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/iron-overlay-behavior/iron-overlay-behavior.html">
<link rel="import" href="../../../bower_components/marked-element/marked-element.html">

<link rel="import" href="../../mixins/utils-functions.html">
<link rel="import" href="../../mixins/redux-mixin.html">
<link rel="import" href="../../mixins/job-offers-hoc.html">
<link rel="import" href="../text-truncate.html">
<link rel="import" href="../shared-styles.html">
<link rel="import" href="dialog-styles.html">

<dom-module id="job-offer-details">
  <template>
    <style is="custom-style" include="shared-styles dialog-styles flex flex-alignment positioning"></style>

    <style>

      .photo {
        margin-right: 16px;
        width: 96px;
        height: 96px;
        border-radius: 50%;
        background-color: var(--contrast-additional-background-color);
        transform: translateZ(0);
        flex-shrink: 0;
      }

      .job-offer-link {
        background-color: var(--default-primary-color);
        color: var(--text-primary-color);
        padding: 4px 8px;
        border-radius: 2px;
        font-size: 14px;
        font-weight: bold;
        transition: background-color var(--animation);
      }

    </style>

    <polymer-helmet
      title="[[jobOffer.title]] | {$ title $}"
      description="[[jobOffer.description]]"
      image="[[jobOffer.logo]]"
      active="[[opened]]"
      label1="{$ position $}"
      data1="[[jobOffer.title]], [[jobOffer.enterprise]]"
    ></polymer-helmet>

    <app-header-layout has-scrolling-region>
      <app-header slot="header" class="header" fixed="[[viewport.isTabletPlus]]">
        <iron-icon
          class="close-icon"
          icon="hoverboard:[[_getCloseBtnIcon(viewport.isLaptopPlus)]]"
          on-tap="_close"
        ></iron-icon>

        <app-toolbar>
          <div class="dialog-container header-content" layout horizontal center>
            <plastic-image
              class="photo"
              srcset="[[jobOffer.logo]]"
              sizing="cover"
              lazy-load preload fade
            ></plastic-image>
            <h2 class="name" flex>[[jobOffer.title]]</h2>
          </div>
        </app-toolbar>
      </app-header>

      <div class="dialog-container content">
        <h3 class="meta-info">[[jobOffer.title]], [[jobOffer.enterprise]]</h3>

        <marked-element class="description" markdown="[[jobOffer.description]]">
          <div slot="markdown-html"></div>
        </marked-element>

        <div class="actions" layout horizontal end-justified>
          <a href="{{ jobOffer.link }}" class="job-offer-link">VOIR PLUS</a>
        </div>

      </div>
    </app-header-layout>

  </template>

  <script>

    // eslint-disable-next-line no-undef
    class JobOfferDetails extends UtilsFunctions(
      // eslint-disable-next-line no-undef
      ReduxMixin(Polymer.mixinBehaviors([Polymer.IronOverlayBehavior], Polymer.Element))
    ) {
      static get is() {
        return 'job-offer-details';
      }

      static get properties() {
        return {
          speaker: {
            type: Object,
          },
          jobOffer: {
            type: Object,
          },
          viewport: {
            type: Object,
            statePath: 'ui.viewport',
          },
          disabledSchedule: {
            type: Boolean,
            value: () => JSON.parse('{$ disabledSchedule $}'),
          },
        };
      }

      constructor() {
        super();
        this.addEventListener('iron-overlay-canceled', this._close);
      }

      _close() {
        dialogsActions.closeDialog(DIALOGS.JOBOFFER);
      }

      _getCloseBtnIcon(isLaptopViewport) {
        return isLaptopViewport ? 'close' : 'arrow-left';
      }
    }

    window.customElements.define(JobOfferDetails.is, JobOfferDetails);
  </script>
</dom-module>
